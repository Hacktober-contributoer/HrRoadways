<!DOCTYPE html>
<html>
<head>
    <title>Notification Test</title>
</head>
<body>
    <h1>Notification Test</h1>
    <button id="requestPermission">Request Notification Permission</button>
    <button id="sendTest">Send Test Notification</button>
    <button id="simulateDelay">Simulate Bus Delay</button>
    <button id="simulateCancellation">Simulate Route Cancellation</button>
    <button id="simulateTraffic">Simulate Traffic Update</button>
    
    <div id="status"></div>

    <script>
        const statusDiv = document.getElementById('status');
        
        // Request notification permission
        document.getElementById('requestPermission').addEventListener('click', async () => {
            try {
                const permission = await Notification.requestPermission();
                statusDiv.innerHTML = `<p>Notification permission: ${permission}</p>`;
            } catch (error) {
                statusDiv.innerHTML = `<p>Error requesting permission: ${error.message}</p>`;
            }
        });
        
        // Send test notification
        document.getElementById('sendTest').addEventListener('click', () => {
            if (Notification.permission === 'granted') {
                new Notification('Test Notification', {
                    body: 'This is a test notification from HrRoadways!',
                    icon: '/assets/icons/icon-192x192.png'
                });
                statusDiv.innerHTML = '<p>Test notification sent!</p>';
            } else {
                statusDiv.innerHTML = '<p>Please grant notification permission first</p>';
            }
        });
        
        // Simulate bus delay
        document.getElementById('simulateDelay').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:50001/api/simulate/delay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        route: 'Delhi-Chandigarh Express',
                        delay: '15 minutes',
                        estimatedTime: '10:30 AM'
                    })
                });
                
                const data = await response.json();
                statusDiv.innerHTML = `<p>Delay simulation response: ${JSON.stringify(data)}</p>`;
            } catch (error) {
                statusDiv.innerHTML = `<p>Error simulating delay: ${error.message}</p>`;
            }
        });
        
        // Simulate route cancellation
        document.getElementById('simulateCancellation').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:50001/api/simulate/cancellation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        route: 'Rohtak-Hisar Local',
                        reason: 'Road construction work'
                    })
                });
                
                const data = await response.json();
                statusDiv.innerHTML = `<p>Cancellation simulation response: ${JSON.stringify(data)}</p>`;
            } catch (error) {
                statusDiv.innerHTML = `<p>Error simulating cancellation: ${error.message}</p>`;
            }
        });
        
        // Simulate traffic update
        document.getElementById('simulateTraffic').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:50001/api/simulate/traffic', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        route: 'Gurgaon-Ambala Highway',
                        update: 'Accident near Karnal',
                        impact: '20 minutes delay expected'
                    })
                });
                
                const data = await response.json();
                statusDiv.innerHTML = `<p>Traffic simulation response: ${JSON.stringify(data)}</p>`;
            } catch (error) {
                statusDiv.innerHTML = `<p>Error simulating traffic: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>